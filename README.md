# Практическая работа №9. Геопространственный анализ

## Цель:
Определить ближайший дилерский центр для каждого клиента. Узнать, каково среднее расстояние между каждым клиентом и ближайшим к нему дилерским центром. Построить карту клиентов и сервисных центров.

## Ход работы:
1. Проверим, установлены ли у нас необходимые расширения для работы:

![image](https://github.com/user-attachments/assets/c9032357-5fa5-40ca-96b8-eed5953fb6ab)

![image](https://github.com/user-attachments/assets/445ecc9a-8c30-4469-b221-90bc88782487)

2. Создаем временную таблицу с координатами каждого клиента и проверяем наличие данных:

![image](https://github.com/user-attachments/assets/7fc1a85f-675f-4494-911f-4e0ae5ea66d3)
![image](https://github.com/user-attachments/assets/7fa9f7aa-bdd0-4ff9-8738-4c7476bcbfee)

3. Создаем аналогичную таблицу для сервисных центров:

![image](https://github.com/user-attachments/assets/4d00f4a6-a134-46e3-9055-d295794ac55c)

4. Объединим эти таблицы, чтобы рассчитать расстояние от каждого клиента до каждого дилерского центра(в киллометрах):

![image](https://github.com/user-attachments/assets/28ad4a67-4534-436b-9ff1-5f5995350ceb)

5.  Определим ближайший дилерский центр для каждого клиента:

![image](https://github.com/user-attachments/assets/b32a2839-532e-424c-9da9-cdbb3722f54e)

6. Рассчитаем среднее расстояние от каждого клиента до его ближайшего дилерского центра:

![image](https://github.com/user-attachments/assets/9a902a0d-b850-4d28-9928-d452bbd3a31d)

7. Проведем выгрузку полученного результата из временной таблицы `closest_dealerships` в CSV:

![image](https://github.com/user-attachments/assets/a6a8d46b-866e-432a-8183-abdcb679ae5d)

Файл `closest_dealerships.csv` находится в репозитории.

8. Удалим все временные таблицы:

![image](https://github.com/user-attachments/assets/e681c595-0a74-4b2a-ad6e-17f1e888315b)

9. Построим карту клиентов и сервисных центров на платформе Yandex Datalens:

![image](https://github.com/user-attachments/assets/953e259f-e596-42a5-85c7-c1f5af05b217)

Так как в одной точке у нас может быть сразу несколько клиентов, создадим дашборд, на который добавим таблицу, которая при нажатии на конкретную точку будет выдавать информацию по всем покупателям в данной точке. Для удобства также добавим индикатор суммы продаж сервисных центров и селектор для выборки идентификационного номера сервисного центра.

![image](https://github.com/user-attachments/assets/dc14fd69-8302-4758-a146-1d91e3235842)

https://datalens.yandex/o04ki4phhjmca - ссылка на работу в Yandex Datalens.

## Выводы:
В ходе выполнения лабораторной работы успешно определены ближайшие дилерские центры для клиентов, расчитано среднее расстояние между каждым клиентом и ближайшим к нему дилерским центром, а также построена карта клиентов и сервисных центров в BI-системе.
